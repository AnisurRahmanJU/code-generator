<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Code Generator</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
body { background:#1e1e1e; color:white; font-family:monospace; padding:20px; margin:0; text-align:center; }
.container { display:flex; flex-direction:column; align-items:center; }
select, button { padding:10px; margin:10px; font-size:16px; border-radius:5px; border:none; outline:none; }

#codeBox {
  max-width:95%; 
  width:100%; 
  background:#2d2d2d; 
  padding:20px; 
  border-radius:8px;
  text-align:left; 
  height:500px; /* fixed height */
  overflow-y:auto; /* vertical scroll */
  overflow-x:auto; /* horizontal scroll if needed */
  white-space:pre; 
  box-shadow:0 0 10px #000;
  margin-top:20px; 
  box-sizing:border-box; 
  position:relative;
}

pre { margin:0; font-family:monospace; font-size:14px; }
.cursor { display:inline-block; width:8px; background:white; margin-left:2px; animation: blink 0.7s steps(1) infinite; }
@keyframes blink { 50% { background: transparent; } }

.copy-btn {
  position:absolute;
  top:10px;
  right:10px;
  color:white;
  cursor:pointer;
  font-size:18px;
  opacity:0.7;
  transition:opacity 0.2s;
}
.copy-btn:hover { opacity:1; }

hr {
  border: 0;
  border-top: 1px solid #555;
  margin:15px 0 10px 0; /* horizontal line close below copy button */
}

@media (max-width:600px){ 
  select, button { width:90%; font-size:14px; } 
  #codeBox { font-size:12px; padding:15px; } 
  .copy-btn { font-size:16px; }
}
</style>
</head>
<body>

<div class="container">
  <h1>Live Multi-Language Code Generator</h1>
  <select id="languageSelect"><option value="">Select Language</option></select>
  <select id="topicSelect" disabled><option value="">Select Topic</option></select>
  
  <div id="codeBox">
    <i class="fa-solid fa-copy copy-btn" title="Copy Code"></i>
    <hr>
    <pre><code id="code" class="language-c"></code><span class="cursor"></span></pre>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

<script>
let codeData = {};
let typingSpeedRange=[15,50];
let lastIndex = {}; // track last snippet for each language-topic

// Load JSON
fetch('codes.json').then(res=>res.json()).then(data=>{ codeData=data; populateLanguages(); });

// Populate language dropdown
function populateLanguages(){
  const langSelect=document.getElementById('languageSelect');
  Object.keys(codeData).forEach(lang=>{
    let option=document.createElement('option'); option.value=lang; option.textContent=lang; langSelect.appendChild(option);
  });
}

// Populate topics dropdown
document.getElementById('languageSelect').addEventListener('change', function(){
  const topicSelect=document.getElementById('topicSelect'); topicSelect.innerHTML='<option value="">Select Topic</option>';
  const lang=this.value;
  if(lang){
    Object.keys(codeData[lang]).forEach(topic=>{
      let option=document.createElement('option'); option.value=topic; option.textContent=topic; topicSelect.appendChild(option);
    });
    topicSelect.disabled=false;
  } else topicSelect.disabled=true;
});

// Load a random snippet (different from last one)
document.getElementById('topicSelect').addEventListener('change', function(){
  const lang=document.getElementById('languageSelect').value;
  const topic=this.value;
  if(lang && topic){
    const codes=codeData[lang][topic];
    let randomIndex;
    do {
      randomIndex=Math.floor(Math.random()*codes.length);
    } while(codes.length>1 && randomIndex === (lastIndex[lang+'-'+topic]||-1));
    lastIndex[lang+'-'+topic]=randomIndex;
    const codeToLoad = codes[randomIndex];
    typeCode(codeToLoad, lang);
  }
});

// Typing animation (preserve formatting)
function typeCode(text, language){
  const codeEl = document.getElementById('code');
  codeEl.className = 'language-' + (language.toLowerCase() === 'javascript' ? 'javascript' : language.toLowerCase());
  codeEl.textContent = '';
  let index = 0;
  const codeBox = document.getElementById('codeBox');

  function typeChar() {
    if (index < text.length) {
      let char = text[index++];
      codeEl.textContent += char;  // type as-is
      Prism.highlightElement(codeEl);
      codeBox.scrollTop = codeBox.scrollHeight;
      codeBox.scrollLeft = codeBox.scrollWidth;
      setTimeout(typeChar, Math.floor(Math.random()*(typingSpeedRange[1]-typingSpeedRange[0]+1)) + typingSpeedRange[0]);
    }
  }
  typeChar();
}

// Copy code to clipboard
document.querySelector('.copy-btn').addEventListener('click', ()=>{
  const codeText=document.getElementById('code').textContent;
  navigator.clipboard.writeText(codeText).then(()=>{
    alert('Code copied to clipboard!');
  });
});
</script>

</body>
</html>
